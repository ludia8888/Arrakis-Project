"""conftest.py
테스트 실행 시 파이썬 모듈 경로(`sys.path`)에 서비스 루트 디렉터리를 동적으로 추가해
`core`, `database`, `middleware` 등 최상위 패키지를 어디서든 임포트할 수 있도록 보장한다.

이 파일은 pytest 가 시작될 때 자동으로 임포트된다. 
별도의 훅이나 플러그인을 사용하지 않고 경로만 주입하므로 다른 테스트 설정을 방해하지 않는다.
"""

from __future__ import annotations

import os
import sys
from pathlib import Path

# --------------------------------------------------------------------------------------------------
# 1단계: 서비스 루트 디렉터리 계산
# --------------------------------------------------------------------------------------------------
# 현재 파일 위치: <서비스 루트>/tests/conftest.py
# 부모 디렉터리의 상위(=서비스 루트)를 얻어 PYTHONPATH 에 삽입한다.
# --------------------------------------------------------------------------------------------------
SERVICE_ROOT: Path = Path(__file__).resolve().parent.parent

# --------------------------------------------------------------------------------------------------
# 2단계: sys.path 에 서비스 루트 추가
# --------------------------------------------------------------------------------------------------
# 이미 추가되어 있지 않은 경우에만 prepend 하여 우선순위를 높인다.
# --------------------------------------------------------------------------------------------------
service_root_str = str(SERVICE_ROOT)
if service_root_str not in sys.path:
    # 최앞단에 삽입하여 테스트 내부 상대 import 가 다른 경로보다 우선하도록 한다.
    sys.path.insert(0, service_root_str) 